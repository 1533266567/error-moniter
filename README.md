# 构建前端异常监控系统

### 背景

最近，刚到新公司，对公司产品进行前端重构；在来公司近一个月中，发现以前产品问题很多，尤其兼容性问题等；在以前项目中也会经常遇到，可能因为某个兼容性问题，导致js代码出错，从而导致整个应用无法运行；但市场上，无论是pc端还是移动端，会有各种不同的系统，不同的浏览器内核，不管是从开发还是测试，都无法完全去兼容和测试所有系统的问题；

所以，使用一个方法能够尽快的定位错误问题就变的紧急及必需；在有一天，看到有一篇专门谈“前端异常监控”的文章，在以前，也有关注此问题，但是从来没有真正去实现过。这次，借助重构机会，在新的架构中，进行前端异常监控系统的搭建，从而能够更快，更好的定位错误，能够更及时的处理错误；

### 实现功能

为了能够达到以上目的，异常监控系统至少应该包含以下几个基础功能：

- 前端错误日志收集，包括通过```window.onerror```及```console.error```报出的错误信息；
- 保存开发过程中的自定义错误，如```try{}catch(e){}```、调用第三方功能错误等；
- 后台保存日志数据(目前通过日志文件进行保存，根据日期，每天一个日志文件保存)；
- 后台对source map压缩文件进行还原定位处理；
- 日志查看，能够通过日期，快速、简明的查看每天的日志数据；
- 用户行为简单跟踪，主要包括点击、输入等操作；

因为错误发生原因很多，为了能够更好的定位错误发生原因及触发发生的时机，后面添加了用户行为跟踪数据，主要包括点击、输入等操作；

### 日志接口数据

```
errorMessage: { // 错误日志信息
	msg: '',
	url: '', // 错误来源页面url
	line: '', // 错误行数
	col: '', // 错误列数
	stack: '',
	from: '', // 错误来源
	"navigator.userAgent": '', //浏览器信息
	ret: {}, // 解析source map后原始准确定位数据
	evtMoniter: [] //用户行为保存数组,保存最近10次行为操作
} 

```



